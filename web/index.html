<!DOCTYPE html>
<html>
<head>
  <base href="$FLUTTER_BASE_HREF">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <meta name="viewport"
        content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
  <meta name="description" content="Kemetic Calendar">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Kemetic Calendar">
  <meta name="theme-color" content="#6B5AED">

  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">
  <link rel="icon" type="image/png" href="favicon.png"/>

  <title>Kemetic Calendar</title>

  <style>
    /* Keep it minimal and safe */
    html, body {
      margin: 0;
      height: 100%;
      background-color: #000000;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    /* Pin Flutter surface to the real viewport and accept touches */
    #flt-glass-pane, .flt-glass-pane, canvas {
      position: fixed !important;
      inset: 0 !important;
      width: 100vw !important;
      height: 100vh !important;
      touch-action: manipulation !important;
      pointer-events: auto !important;
      z-index: 1 !important;
    }

    /* Do NOT fix the body or hide overflow; that causes iOS PWA desyncs */
    /* Removed:
       @supports (-webkit-touch-callout: none) { body { position: fixed; width:100%; height:100%; overflow:hidden; } }
    */

    /* Optional: interactive elementsâ€”fine to keep */
    button, [role="button"], a, input, textarea, select {
      touch-action: manipulation !important;
    }
  </style>

  <script>
    // iOS PWA: gently "nudge" layout like a fake rotate to ensure correct glass-pane metrics
    (function () {
      const isIOS = /iphone|ipod|ipad/i.test(navigator.userAgent);
      const isStandalone = window.matchMedia('(display-mode: standalone)').matches || (window.navigator.standalone === true);

      function nudge() {
        // trigger layout + two resizes
        window.scrollTo(0, 1);
        requestAnimationFrame(() => {
          window.dispatchEvent(new Event('resize'));
          setTimeout(() => window.dispatchEvent(new Event('resize')), 60);
        });
      }

      window.addEventListener('load', () => {
        if (isIOS && isStandalone) { nudge(); setTimeout(nudge, 300); }
      }, { once: true });

      window.addEventListener('touchstart', () => {
        if (isIOS && isStandalone) nudge();
      }, { once: true, passive: true });
    })();
  </script>
</head>
<body>
<script>
  // ðŸ‘‡ request persistent storage on Safari
  if (navigator.storage && navigator.storage.persist) {
    navigator.storage.persist().then(function (granted) {
      console.log('Persistent storage granted:', granted);
    });
  }

</script>
<script>
  // Cache-bust the bootstrap script to avoid stale service worker bundles after deploys
  (function () {
    const cacheBuster = Date.now().toString();
    const s = document.createElement('script');
    s.src = 'flutter_bootstrap.js?v=' + cacheBuster;
    s.async = true;
    document.body.appendChild(s);
  })();
</script>
</body>
</html>
